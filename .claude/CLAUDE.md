# CLAUDE.md

このファイルは Claude Code (claude.ai/code) のグローバル設定を提供します。

## 会話ガイドライン

- 思考は英語で行って良いが、最終的な出力・会話は日本語で行う
- コードのコメントは日本語で記述する
- エラーメッセージや UI テキストは日本語を使用する
- 技術的に詰まった場合は gemini cli を使って英語で相談する

## 基本ルール

### 1. 相互尊重と責任感

- ユーザーの時間と判断を尊重する
- 実装前に計画を共有し、承認を得る
- 既存テストなど重要なものは勝手に削除しない

### 2. 透明性とコミュニケーション

- 分からないことは素直に「分からない」と言う
- 不確実な部分は隠さず伝える
- 作業完了時は適切に報告する
- **IMPORTANT**: 全ての作業やタスク完了時に必ず星マーク（⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️⭐️）を出力して作業完了を明確に示す

### 3. 品質保証

- テスティングライブラリがある場合は Testing Trophy + t-wada の TDD で品質を担保
- 型エラーは根本的な設計を見直して解決する（`any`や`@ts-ignore`での回避は避ける）

## アプリケーション起動ルール

### ポート番号の管理
- **重要**: アプリケーション起動時はデフォルトポート + 4 を使用する
  - 例: デフォルトが3000の場合 → 3004で起動
  - 例: デフォルトが4000の場合 → 4004で起動
  - 例: デフォルトが8080の場合 → 8084で起動

### プロセス管理
- **必須**: 自分が起動したアプリケーションは作業終了時に必ず停止する
- プロセスIDを記録し、適切にkillコマンドで終了させる
- バックグラウンドで動作しているサーバーも忘れずに停止する

## 利用可能ツール

よく使用するツール：

- **git**: バージョン管理
- **gh**: GitHub CLI
- **ripgrep**: 高速テキスト検索
- **fd**: ファイル検索
- **fzf**: ファジーファインダー
- **lazygit**: Git 用 TUI
- **eza**: ls の代替
- **bat**: ファイル表示（色付き）
- **zoxide**: ディレクトリジャンプ

JavaScript/TypeScript 開発：

- **bun/deno**: ランタイム
- **yarn**: パッケージマネージャ
- **playwright**: ブラウザ自動化テスト
- **tsc**: TypeScript コンパイラ



## 開発ワークフロー

### テスト駆動開発（TDD）

1. 期待される入出力に基づきテストを作成
2. テストを実行し、失敗を確認
3. テストが正しいことを確認できた段階でコミット
4. テストをパスさせる実装を進める
5. 実装中はテストを変更せず、コードを修正し続ける

### 品質保証プロセス

1. **事前チェック**: `tsc -- --noEmit`とプロジェクトに導入されている lint ツールを実行
2. **段階的修正**: 各問題を体系的に対処
3. **検証**: 修正後に再度チェック実行
4. **クリーンアップ**: 一時ファイル削除、サーバー停止
5. **フォーマット**: (可能ならlint fix) + プロジェクトに導入されているフォーマッターを実行

## TypeScript 開発ガイドライン

### 型安全性の重要ルール

- `any`型の使用を避ける
- `as`による型アサーションでの安易な解決を避ける
- `@ts-ignore`や`@ts-expect-error`の使用を避ける
- `!`（非 null アサーション演算子）の安易な使用を避ける

### 推奨される解決方法

1. **根本的な型定義の見直し**

   - インターフェースを適切に定義
   - ジェネリクスを活用した型の汎用化

2. **型ガードの実装**

   ```typescript
   function isString(value: unknown): value is string {
     return typeof value === "string";
   }
   ```

3. **strict モードでの開発**
   - `strict: true`を維持
   - `strictNullChecks`を有効にして開発

### パスエイリアスの使用

```typescript
// ✅ 正しい
import { Guest } from "@/types";
import { Button } from "@/components/ui/button";

// ❌ 避ける
import { Guest } from "../../../types";
```

## トラブルシューティング

### 型エラーが解決できない場合

1. 型が正しくインポートされているか確認
2. tsconfig パスが動作しているか確認: `tsc --traceResolution`
3. TS キャッシュをクリア: `rm -rf node_modules/.cache`
4. 複雑な型推論には`satisfies`演算子を使用

### ビルドエラーが発生した場合

1. 型チェックを最初に実行: `tsc -- --noEmit`
2. 依存関係の確認: `npm install`
3. 全キャッシュをクリア: `rm -rf .next node_modules/.cache`
4. 循環依存の確認

## Claude Code でのコミット方法

### 基本的な方法

```
「コミットして」または「commit」と依頼
```

### Claude Code が自動で行うこと

- `git status`と`git diff`で変更内容を確認
- 変更内容に基づいて適切なコミットメッセージを生成
- 日本語でのコミットメッセージ作成


## 知見管理システム

効率的な知見の蓄積・活用のために以下のファイル構成を使用：

```
.claude/                     # 各プロジェクトのclaude用ディレクトリ
├── CLAUDE.md                # Claude Codeとの連携ガイド
├── context.md               # プロジェクトの背景・制約条件
├── project-knowledge.md     # 技術的知見・実装パターン
├── project-improvements.md  # 改善履歴・教訓
├── common-patterns.md       # 頻用コマンド・パターン集
├── debug-log.md             # 重要なデバッグ記録
└── plan.md                  # 作業記録
```

### 運用方針

1. **継続的更新**: 新しい知見は即座に該当ファイルに記録
2. **月次整理**: 月 1 回、情報の整理・統合・古い情報の削除
3. **定期参照**: Claude Code 使用時に関連ファイルを参照

## ライブラリ調査方針

- **第一選択**: context7 MCPを使用する
  - `mcp__context7__resolve-library-id` でライブラリIDを特定
  - `mcp__context7__get-library-docs` で最新のドキュメントを取得
- **第二選択**: context7で見つからない場合はGitHubリポジトリを直接確認
  - WebFetchを使ってGitHubのREADMEやドキュメントを取得
  - 設定ファイルやソースコードを直接確認
  - 特にオープンソースプロジェクトでは、GitHubが最も正確で最新の情報源

## プロジェクト固有の設定

プロジェクト固有の設定は各プロジェクトの`.claude/CLAUDE.md`ファイルに記載してください。

- 詳細なアーキテクチャ
- フレームワーク固有の設定
- プロジェクト特有のコマンド
- チーム内のコーディング規約
